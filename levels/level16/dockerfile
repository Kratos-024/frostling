# This Dockerfile builds the 'client-container' where the user starts
FROM alpine:latest

# Install tools for the challenge: tar for extraction, ssh for connecting
RUN apk add --no-cache openssh bash tar

# --- Setup for User 'level16' ---
RUN adduser -D -s /bin/bash level16 && \
    echo "level16:VR51lPJKJNgQv5b" | chpasswd

# --- Create the Challenge File ---
# This part is tricky. We need the id_rsa file from the server.
# We will create a temporary key here and package it.
# This ensures the client Dockerfile can build independently.
RUN mkdir -p /tmp/temptarget/.ssh
RUN ssh-keygen -t rsa -b 2048 -f /tmp/temptarget/.ssh/id_rsa -N ""
RUN tar -cf /home/level16/secret_package.tar -C /tmp/temptarget/.ssh id_rsa
RUN chown level16:level16 /home/level16/secret_package.tar
RUN rm -rf /tmp/temptarget

# --- Switch to the user for the interactive session ---
USER level16
WORKDIR /home/level16

# --- Keep the container running for the user ---
CMD ["/bin/bash", "-c", "tail -f /dev/null"]
